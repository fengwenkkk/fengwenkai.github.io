![输入图片说明](/imgs/2024-05-11/qD46QUhvBdPTSC7B.webp)![输入图片说明](![输入图片说明](/imgs/2024-06-06/1niGqIM2yBCblfv5.webp)![输入图片说明](/imgs/2024-06-06/qJB6S9cklH4eV5gg.webp)/imgs/2024-05-11/5lEz04eekNhQONLt.webp)



# 项目介绍
## 简述
你好面试官，我的这个项目是采用C++语言编写的，在linux下编译。首先编写项目框架，创建线程池，分别实现收，解析，发操作和连接线程的回收，然后在收到通信请求后根据格式处理粘包，进入处理队列，等待处理线程执行通讯信息的解析和自定义，进入发送线程转发。
## 详细
首先是心跳线程：连接是否成功，通信对象是否启动
接收请求：使用select处理请求，然后epoll多路复用的技术去处理我们海量的请求
业务线程：处理请求，封装不同的数据包
发送线程：发送数据给调度台
回收线程：来去定时轮询连接信息是否可以清空，留给下一个用户使用
## 数据包业务怎么实现
收到的信息为json格式，定义头文件，根据头文件进行匹配，进入不同的业务处理线程，实现相应的业务函数，比如：XXXX
## 线程池
避免频繁创建线程，销毁线程带来的性能开销，线程池可以增强项目的稳定性。线程池是在程序初始化的时候就 创建好了的。具体来说就是使用pthread创建好线程， 封装一个线程池的类， 去统一管理， 我们使用了条件变量去触发线程执行任务。只要框架在运行，那么线程都会一直存在一直服务， 在框架停止服务后， 通过全局变量isrunning来确定是否停止服务，为true时，那么通过**pthread_join函数销毁线程。**

#### 4、看你还实现了线程，为什么需要线程池?

线程池主要是为了避免频繁创建线程，销毁线程带来的性能开销，线程池可以增强项目的稳定性。

#### 5、⭐⭐线程池是怎么实现的？

线程池是在程序初始化的时候就 创建好了的。具体来说就是使用pthread创建好线程， 封装一个线程池的类， 去统一管理， 我们使用了条件变量去触发线程执行任务。

  

#### 6、线程池中的线程执行完了如何销毁的？

只要框架在运行，那么线程都会一直存在一直服务， 在框架停止服务后， 通过全局变量isrunning来确定是否停止服务，为true时，那么通过**pthread_join函数销毁线程。**

#### 7、⭐⭐会不会出现线程池中的线程被全部用完的情况？应该如何避免？（这个问题跟8、11有联系可以多看看）

有可能出现这种情况，线程池中的线程确实可能被用完，**这种情况称为线程池饱和**。

当线程池没有空闲线程执行时， 那么任务会在我们的队列中等待执行，为了应对这种情况，我们可以在配置文件中可以动态配置线程池的大小。

#### 8、⭐️只有这一种方法吗？还有其余方法可以避免线程被用完吗？

为了避免线程池饱和，除了上面提到的调整线程池的数量外，还可以可以采取以下几个措施（1、2、4比较通用一些）：

-   **1、限制任务的提交速率**：通过限制任务的提交速率，可以减少线程池中的线程被占满的可能性。可以使用一些限流技术，如令牌桶算法、漏桶算法等。
-   2、**优化任务的执行时间**：如果线程池中的线程经常被占满，可能是由于任务执行时间过长导致的。可以对任务进行性能优化，减少任务的执行时间。
-   3、**使用有界队列**：线程池中的任务队列可以是无界队列（如LinkedBlockingQueue），也可以是有界队列（如ArrayBlockingQueue）。如果采用有界队列，当队列满时，新的任务会被拒绝，从而避免线程池饱和。
-   **4、使用拒绝策略**：当线程池饱和时，可以使用合适的拒绝策略来处理新的任务。常见的拒绝策略有：直接丢弃任务、丢弃队列中最旧的任务、抛出异常等。

一般来说，通过合理调整线程池的大小、限制任务的提交速率、优化任务的执行时间、使用有界队列和合适的拒绝策略，可以避免线程池中的线程被全部用完的情况。

#### 9、看你也实现了连接池，为什么需要连接池？

连接池的实现借鉴了线程池的思想，因为我们不想每来一个用户就去创建一个连接，当用户退出的时候， 可以把连接信息给清空，继续保存好我们的内存，不用重复去开辟。

#### 10、⭐️那你为什么说用了延迟回收？/延迟回收的目的是什么？

因为用户退出后，可能我们的读写线程还在处理我们用户的一些业务功能， 所以需要保存一段时间。

等待用户完成了它之前的功能， 然后再把信息去掉，进行回收，不然当新用户用了这个连接，但处理的不是新用户的信息，那么就会有异常了， 所以采用了延迟回收，定时去回收我们的连接。

#### 11、如果出现任务堆积，线程池不够用，那这些任务不要了？（该问题其实是8中的一个方式）

会把业务请求放到一个队列，当有空闲线程，会通过条件变量去触发线程去执行。

#### 12、⭐️网络通讯为什么会出现粘包现象？/粘包现象的原因是什么？

主要因为tcp是流式协议，没有说哪里开始，哪里结束。粘包现象是指在网络通信中，发送方发送的数据包被接收方一次性接收了多个包的情况。

粘包现象的产生可能有以下几个原因：

-   发送方连续发送多个数据包：发送方在发送数据包时，可能会连续发送多个包，而接收方在接收时可能一次性接收到多个包，导致粘包现象。
-   接收方接收缓冲区大小限制：接收方的接收缓冲区大小有限，当发送方发送的数据包超过接收缓冲区大小时，就会发生粘包现象。
-   网络传输延迟和拥塞：网络传输中可能会出现延迟和拥塞，导致数据包在传输过程中被缓存起来，当缓存的数据包一次性被接收方接收时，就会出现粘包现象。
-   应用层协议设计问题：某些应用层协议设计不合理，没有考虑到粘包问题，导致在数据包的分割和组装过程中出现问题，从而产生粘包现象。

#### 13、如果出现粘包现象该怎么解决？

为避免粘包现象的发生，可以采取以下措施（1、3比较好一些）：

-   1、使用固定长度的数据包：在发送数据包时，可以将每个数据包固定为相同的长度，接收方按照固定长度的方式进行接收，从而避免粘包现象。
-   2、使用分隔符或特殊字符：在数据包中添加分隔符或特殊字符，接收方根据分隔符或特殊字符来识别数据包的边界，进行分包接收。
-   3、使用消息头和消息体：在数据包中添加消息头和消息体，消息头中可以包含数据包的长度信息，接收方根据消息头中的长度信息来分包接收。
-   4、增加延时：发送方在发送完一个数据包后，可以适当增加延时，等待接收方接收完毕后再发送下一个数据包，从而避免粘包现象的发生。

  

#### 14、⭐️⭐️⭐️【情景拓展】你认为什么样的服务器才算是一个高性能的服务器？

至少应该具备高带宽、低延迟、高存储能力、高可靠性、可扩展性等能力才算得上一个好的服务器，当然处理能力也不能弱。

#### 15、为什么高性能的服务器需要处理能力强？(14题的变种)

处高性能的服务器应具备强大的处理能力，能够快速处理大量的并发请求。它可能采用多核处理器、高速缓存、多线程等技术来提升处理能力。

#### 16、为什么高性能的服务器需要高带宽和低延迟？(14题的变种)

高性能的服务器应具备高带宽和低延迟的网络连接能力，能够快速地传输大量的数据。它可能采用高速网络接口、专用网络设备等来提升网络性能。

#### 17、为什么高性能的服务器需要有高存储能力？(14题的变种)

高性能的服务器应具备高存储能力，能够存储大量的数据。它可能采用高速硬盘阵列、固态硬盘等来提升存储性能。

#### 18、为什么高性能的服务器需要高可靠性和可扩展性？(14题的变种)

高性能的服务器应具备高可靠性和可扩展性，能够保证系统的稳定性和可用性。它可能采用冗余备份、热插拔等技术来提高可靠性，采用集群、负载均衡等技术来提高可扩展性。

  

#### 19、为什么高性能的服务器需要优化的软件配置？(14题的变种)

性能的服务器应具备优化的软件配置，能够充分利用硬件资源，并提供高效的服务。它可能采用优化的操作系统、数据库、Web服务器等软件来提升性能。
#### 20、为什么高性能的服务器需要良好的系统监控和管理？(14题的变种)

高性能的服务器应具备良好的系统监控和管理功能，能够实时监测系统的运行状态，并进行故障诊断和性能优化。它可能采用监控工具、日志分析工具等来实现系统监控和管理。
#### 遇到的问题


<!--stackedit_data:
eyJoaXN0b3J5IjpbMTg5NzUyNTQwOCwxMTkxNTExMzY1XX0=
-->